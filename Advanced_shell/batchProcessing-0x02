#!/usr/bin/env bash

POKEMON_LIST="bulbasaur ivysaur venusaur charmander charmeleon"

OUTPUT_DIR="pokemon_data"
mkdir -p "$OUTPUT_DIR"

API_BASE="https://pokeapi.co/api/v2/pokemon"
DELAY=1
MAX_RETRIES=3

echo "Starting batch Pokémon data retrieval..."

for pokemon in $POKEMON_LIST; do
    URL="$API_BASE/$pokemon"
    OUTPUT_FILE="$OUTPUT_DIR/$pokemon.json"
    
    attempt=1
    success=false

    while [ $attempt -le $MAX_RETRIES ]; do
        echo "Fetching data for $pokemon (Attempt $attempt)..."

        if curl -sS "$URL" -o "$OUTPUT_FILE"; then
            echo "Saved data to $OUTPUT_FILE ✅"
            success=true
            break
        else
            echo "Error fetching data for $pokemon ❌"
            attempt=$((attempt + 1))
            sleep "$DELAY"
        fi
    done

    if [ "$success" = false ]; then
        echo "Failed to fetch data for $pokemon after $MAX_RETRIES attempts. Skipping..."
    fi

    sleep "$DELAY"
done

echo "Data retrieval complete."
