#!/usr/bin/env bash

POKEMON_LIST="bulbasaur ivysaur venusaur charmander charmeleon"
OUTPUT_DIR="pokemon_data"
mkdir -p "$OUTPUT_DIR"

API_BASE="https://pokeapi.co/api/v2/pokemon"

echo "Starting batch Pokémon data retrieval in parallel with job control..."

pids=()  # array to store process IDs

# function to fetch a single pokemon
fetch_pokemon() {
    local pokemon=$1
    local url="$API_BASE/$pokemon"
    local output_file="$OUTPUT_DIR/$pokemon.json"

    echo "Fetching data for $pokemon..."
    
    if curl -sS "$url" -o "$output_file"; then
        echo "Saved data to $output_file ✅"
    else
        echo "Error fetching data for $pokemon ❌"
    fi
}

# loop through each pokemon and run fetch in background
for pokemon in $POKEMON_LIST; do
    fetch_pokemon "$pokemon" &
    pids+=($!)  # save PID of background process
done

# list all background jobs
echo "Currently running background jobs:"
jobs

# wait for all background processes to finish
for pid in "${pids[@]}"; do
    wait $pid
done

echo "All Pokémon data retrieval complete."
